# <img src="https://raw.githubusercontent.com/Different-Name/nix-files/master/assets/nixoscolorful.svg" height=26> nix-files

My NixOS configuration files

> [!WARNING]
> This flake is tailored for my personal setup and is under active development. I can’t guarantee that any modules, packages, or configurations are tested, stable, or maintained
> 
> Feel free to explore, adapt, or contribute as you like <3

- **Flake-based** NixOS configuration
- **Multi-host**, **multi-user**
- **Modular structure**, everything imported by [import-tree](https://github.com/vic/import-tree)
- **Declarative disk layout** with [disko](https://github.com/nix-community/disko) (**btrfs** + **LUKS**)
- **Ephemeral root and home** via [impermanence](https://github.com/nix-community/impermanence)
- **Declarative user environments** using [home-manager](https://github.com/nix-community/home-manager)
- **Hyprland-based** graphical session
- Package versions **tracked** with [nvfetcher](https://github.com/berberman/nvfetcher)

## Concepts

Instead of choosing functionality through importing files, this flake utilizes **parts** - small, focused, reusable configuration files

These are:

- **Always imported**
- **Toggleble** through `enable` options
- **Grouped logically** (e.g. `desktop`, `system`, `terminal`)

Common combinations of options are abstracted into **profiles**, which are preconfigured option sets that represent **high level** applications such as `graphical` or `laptop`

Users are defined as modules too, allowng complete user configurations to be enabled and disabled per host

With these abstractions, host files are declarative configurations that **compose systems by toggling `users`, `profiles` and `parts`**

This enables:

- **Modularity** and reusability
- **Composition** from well-scoped building blocks
- **Deduplication** of configuration across hosts and users

## Structure

### `/configurations`

`nixosConfigurations` are defined here. Each host has their own directory with:

- **default.nix**: Host-specific imports (e.g. `nixos-hardware.nixosModules.common-cpu-amd`)
- **hardware-configuration.nix**: Auto-generated by `nixos-generate-config`, not a module
- **disk-configuration.nix**: Used by `disko`, not a module

```
configurations
└── <host>
    ├── default.nix
    ├── hardware-configuration.nix
    └── disk-configuration.nix
```

These are seperated from the modular config system due to their external constraints

### `/nixos`

System-level modules for NixOS, organized as:

```
nixos
├── parts       # Reusable config files
├── profiles    # High-level presets for system roles
├── users       # System user definitions and settings
└── hosts       # Top-level host configurations
```

- Hosts and users are **configured independently**
- A user can be **shared** across multiple systems
- Hosts define which users are present, but **don't embed user config**

> *Each system defines which users it has, but users can share common configuration across systems*

### `/home`

home-manager modules for user environments, organized **user first**:

```
home
├── parts           # Reusable config files
├── profiles        # High-level presets for system roles
└── users           # A user's home config, shared between hosts
    └── <user>
        └── hosts   # A user's home config, for a specific host
```

- Each user defines their base config
- Host are configured **in the context of a specific user**
- configuration is shared across machines on a **per-user** basis

> *Each user defines their own home environment, which adapts depending on the machine they're on*

## Acknowledgements

- [Graham Christensen - Erase your darlings](https://grahamc.com/blog/erase-your-darlings/)
- [Misterio77/nix-starter-configs](https://github.com/Misterio77/nix-starter-configs)
- [fufexan/dotfiles](https://github.com/fufexan/dotfiles)
- [mightyiam/dendritic](https://github.com/mightyiam/dendritic)